C51 COMPILER V9.01   NEWHOST                                                               07/23/2013 14:15:08 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE NEWHOST
OBJECT MODULE PLACED IN .\out\newHost.obj
COMPILER INVOKED BY: D:\Program Files (x86)\keil\C51\BIN\C51.EXE newHost.c LARGE BROWSE DEBUG OBJECTEXTEND PRINT(.\listi
                    -ng\newHost.lst) OBJECT(.\out\newHost.obj)

line level    source

   1          #include"N79E81x.h"
   2          #include<intrins.h>
   3          #include"AD.h"
   4          #include"T0.h"
   5          #include"voice.h"
   6          #include"pwm.h"
   7          #include"T1.h"
   8          
   9          #define CmdStart 0x00 //¿ª»úÃüÁî
  10          #define CmdStop 0x01  //¹Ø»úÃüÁî
  11          
  12          #define ComMode_1 0xc1 //Í¨ĞÅÄ£Ê½1 
  13          #define ComMode_2 0xc2 //Í¨ĞÅÄ£Ê½2
  14          #define ComMode_3 0xc3 //Í¨ĞÅÄ£Ê½3
  15          #define ComMode_4 0xc4 //Ì§ÆğÖ¸Áî
  16          #define ComMode_5 0xc5//µ¹µØÖ¸Áî
  17          
  18          #define Succeed 0xce  //Í¨ĞÅ³É¹¦
  19          #define Wrong 0xff    //Í¨ĞÅÊ§°Ü
  20          
  21          #define CmdHead 0xc8
  22          #define CmdHead1 0x33 //Êı¾İÖ¡µÄÊ×²¿1, 00110011,11
  23          #define CmdHead2 0xcc //Êı¾İÖ¡µÄÊ×²¿2,11001100,00
  24          #define CmdHead3 0x3c //Êı¾İÖ¡µÄÊ×²¿3,11000011,01
  25          #define CmdHead4 0xcc //Êı¾İÖ¡µÄÊ×²¿4,11001100,00
  26          
  27          #define MyAddress 0xe0
  28          #define MyAddress1 0x33 //±¾»úµØÖ·1, 00110011,11
  29          #define MyAddress2 0x3c //±¾»úµØÖ·2, 11000011,01
  30          #define MyAddress3 0xcc //±¾»úµØÖ·3,11001100,00
  31          #define MyAddress4 0xcc //±¾»úµØÖ·4,11001100,00
  32          
  33          sbit ModeControl_1=P2^6;        //ÎŞÏß·¢Éä»úÄ£Ê½¿ØÖÆ£¬1ÎªĞ¡¹¦ÂÊ£¬0Îª´ó¹¦ÂÊ
  34          sbit ReceWave=P0^7;                     //ÈıÖá´«¸ĞÆ÷ÊäÈë¶Ë£¬1±íÊ¾ÎŞÕñ¶¯£¬0±íÊ¾ÓĞÕñ¶¯
  35          sbit SensorControl=P2^5;        //ÈıÖá´«¸ĞÆ÷Ê¹ÄÜ¶Ë£¬1´ò¿ª´«¸ĞÆ÷£¬0¹Ø±Õ´«¸ĞÆ÷
  36          sbit tran_en=P2^7;                      //ÎŞÏß·¢Éä»úÊ¹ÄÜ¿ØÖÆ£¬1Îª´ò¿ª·¢Éä»ú£¬0Îª¹Ø±Õ·¢Éä»ú
  37          sbit MagentControl_1=P2^2;      //µç´ÅÌúÁ½¸ö¶Ë¿Ú£¬¿ØÖÆµç´ÅÌúÕı×ª»òÕß·´×ª
  38          sbit MagentControl_2=P2^3;
  39          sbit VoiceControl=P2^4;         //Ê°ÒôÆ÷Ê¹ÄÜ¶Ë£¬1´ò¿ªÊ°ÒôÆ÷£¬0¹Ø±ÕÊ°ÒôÆ÷
  40          sbit PAshutdown=P1^4;           //¹¦·Å¿ª¹Ø¿ØÖÆ£¬1Îª´ò¿ª¹¦·Å£¬0Îª¹Ø±Õ¹¦·Å
  41          
  42          unsigned char count=0;//Êı¾İ½ÓÊÕ²¿·ÖµÄ¼ÆÊıÆ÷
  43          
  44          unsigned int time0Count_1=0;//×÷ÎªÈıÖá´«¸ĞÆ÷Á½¸öÂö³åÖ®¼äµÄÊ±¼ä¼ä¸ô¼ÆÊ±
  45          unsigned int time0Count_2=0;//×÷ÎªÈıÖá´«¸ĞÆ÷µÄ¼ÆÊ±
  46          unsigned int time0Count_3=0;//¶¨Ê±Æ÷T0µÄ¼ÆÊı
  47          unsigned int time0Count_4=0;//×÷ÎªÌ§ÆğÂö³åµÄÊ±¼ä¼ä¸ô¼ÆÊ±
  48          unsigned int time0Count_5=0;//×÷Îªµ¹µØÂö³åµÄÊ±¼ä¼ä¸ô¼ÆÊ±
  49          
  50          bit SensorFlag=0;                               //ÈıÖá´«¸ĞÆ÷µÄµÍµçÆ½±êÖ¾Î»
  51          unsigned char SensorCount=0;    //×÷ÎªÈıÖá´«¸ĞÆ÷Âö³åµÄ¼ÆÊı
  52          unsigned char TestFlag=0;               //Ã¿3s¼ÆÊı¼Ó1£¬Èç¹ûÍ¨ĞÅ³É¹¦£¬Ôò½«Æä¹éÁã¡£ÉèÖÃÈç¹ûÁ¬Ğøn´Î¶¼Ã»ÓĞ¹éÁã£¬ÔòËµÃ÷²»ÔÚ³
             -¡ÁË
  53          unsigned char ModeFlag=1;               //Ä£Ê½Ñ¡ÔñÎ»£¬1ÔòÓÃÄ£Ê½1,2ÔòÓÃÄ£Ê½2,3ÔòÎªÄ£Ê½3
C51 COMPILER V9.01   NEWHOST                                                               07/23/2013 14:15:08 PAGE 2   

  54          
  55          bit alarmFlag=0;                                //±¨¾¯ÓïÒôµÄ¿ªÆô±êÖ¾
  56          bit alarmFlag2=0;                               //±¨¾¯ÓïÒô±êÖ¾2
  57          unsigned char alarmCount=0;             //±¨¾¯ÓïÒôµÄ´ÎÊı
  58          
  59          bit downUpFlag=0;                               //µ¹µØºÍÌ§Æğ¼ì²â±êÖ¾
  60          bit downFlag=0;                                 //µ¹µØµÄ±êÖ¾
  61          bit upFlag=0;                                   //Ì§ÆğµÄ±êÖ¾
  62          bit downFlagSend=0;                             //µ¹µØ·¢ËÍµÄ±êÖ¾
  63          bit upFlagSend=0;                               //Ì§Æğ·¢ËÍµÄ±êÖ¾
  64          
  65          //×÷Îª½ÓÊÕºÍ·¢ËÍµÄ»º´æÇø
  66          unsigned char TxRxBuf[28]={0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
             -,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
  67          
  68          //Ò»¸öÍ·×Ö½Ú£¬Ò»¸öµØÖ·×Ö½Ú£¬Ò»¸öÃüÁî×Ö½Ú£¬Á½¸ö±àÂëµØÖ·×Ö½Ú£¬Á½¸ö±àÂë
  69          unsigned char myTxRxData[7]={0x00,0x00,0x00,0x00,0x00,0x00,0x00};//´¦ÀíÍêºóµÄÍ¨ĞÅÊı¾İµÄ»º³åÇø
  70          
  71          unsigned int Check2=0;          //µçÁ¿¼ì²â
  72          unsigned char Check1=0;         //×÷ÎªAD¼ì²âÖµ£¬Ê°ÒôÆ÷¼ì²â£¬Æ½Ê±ÔëÉùÎª1VÒÔÄÚ£¬ÓĞĞÅºÅÊ±Îª1.5V
  73          
  74          bit receiveFlag=0;                      //½ÓÊÕµ½Êı¾İ±êÖ¾
  75          bit commuFlag=0;                        //¿ªÆôÍ¨ĞÅ±êÖ¾
  76          
  77          unsigned char DataBetween=0;//×÷Îª½ÓÊÕÊı¾İµÄÖĞ¼ä±äÁ¿
  78          unsigned char RecData=0;        //½ÓÊÕµ½µÄÊı¾İ
  79          unsigned char DataTime=0;       //×÷Îª½ÓÊÕµÄÊı¾İµÄÒÆÎ»´ÎÊı¼ÆÊı
  80          bit ComFlag=1;                          //×öÉÏÉıÑØµÄÒ»¸ö±êÖ¾
  81          unsigned char T1highcount=0;            //¶¨Ê±Æ÷T1ÔÚÃ»ÓĞĞÅºÅµ½À´µÄÊ±ºò£¬¶Ô¸ßµçÆ½¼ÆÊı£¬Ò»µ©³¬¹ıÄ³¸öÖµ£¬Ôò½«Datatim
             -eÇå0
  82          
  83          unsigned char magnetflag=0;                     //¶¨Òåµç´ÅÌú×ª¶¯Óë·ñ
  84          unsigned char powerflag=1;                      //¶¨ÒåµçÑ¹±¨¾¯±êÖ¾Î»
  85          unsigned char commode2_flag=0;          //·¢ËÍ±àÂë2µÄ±êÖ¾Î»
  86          
  87          //º¯ÊıÉùÃ÷
  88          void ComMode_1_Data(void);                      //·¢ËÍÄ£Ê½1±àÂë
  89          void ComMode_2_Data(void);                      //·¢ËÍÄ£Ê½2±àÂë
  90          void ComMode_22_Data(void);                     //·¢ËÍÄ£Ê½2±àÂë
  91          void ComMode_3_Data(void);                      //·¢ËÍÄ£Ê½3±àÂë
  92          void ComMode_4_Data(void);                      //·¢ËÍÌ§Æğ±àÂë
  93          void ComMode_5_Data(void);                      //·¢ËÍµ¹µØ±àÂë
  94          
  95          void Delay3(unsigned int t)                     //t=1Ê±£¬ÑÓ³Ù100us×óÓÒ
  96          {
  97   1              unsigned int i,j;
  98   1              for(i=0;i<t;i++)                
  99   1              for(j=0;j<19;j++);
 100   1      }
 101          void Delay33(unsigned int t)
 102          {
 103   1              unsigned int i,j;
 104   1              for(i=0;i<t;i++)                
 105   1              for(j=0;j<26;j++);
 106   1      }
 107          
 108          void initsignal()                                       //init signal£¬·¢ËÍ±àÂëĞÅºÅÇ°µÄÆğÊ¼ĞÅºÅ£¬ÓÃÓÚ½«½ÓÊÕ»úµÄ×Ô¶¯ÔöÒæ´ò¿ª
 109          {
 110   1              unsigned char k,k1;
 111   1              unsigned char mystartbuffer=0xb4;
 112   1              for(k1=0;k1<1;k1++)
 113   1              {
C51 COMPILER V9.01   NEWHOST                                                               07/23/2013 14:15:08 PAGE 3   

 114   2                      for(k=0;k<8;k++)
 115   2                      {
 116   3                              if((mystartbuffer&0x80)==0x80)//Îª1
 117   3                              {
 118   4                                      P10=0;
 119   4                                      Delay3(300);            //ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 120   4                              }
 121   3                              else                                    //Îª0µÄÇé¿ö
 122   3                              {
 123   4                                      P10=0;
 124   4                                      Delay3(300);            //ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 125   4                              }
 126   3                              P10=1;                                  //³£Ì¬Îª¸ßµçÆ½
 127   3                              mystartbuffer<<=1;
 128   3                              Delay3(100);                    //ÑÓÊ±Òª´óÓÚ2ms
 129   3                      }
 130   2                      mystartbuffer=0xaa;
 131   2                      Delay3(50);
 132   2              }
 133   1              P10=1;
 134   1      }
 135          
 136          void initsignal2()
 137          {
 138   1              unsigned char k,k1;
 139   1              unsigned char mystartbuffer=0xb4;
 140   1              for(k1=0;k1<8;k1++)
 141   1              {
 142   2                      for(k=0;k<8;k++)
 143   2                      {
 144   3                              if((mystartbuffer&0x80)==0x80)          //Îª1
 145   3                              {
 146   4                                      P10=0;
 147   4                                      Delay3(205);                                    //ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 148   4                              }
 149   3                              else                                                            //Îª0µÄÇé¿ö
 150   3                              {
 151   4                                      P10=0;
 152   4                                      Delay3(205);                                    //ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 153   4                              }
 154   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 155   3                              mystartbuffer<<=1;
 156   3                              Delay3(70);                                                     //ÑÓÊ±Òª´óÓÚ2ms
 157   3                      }
 158   2                      mystartbuffer=0xaa;
 159   2                      Delay3(35);
 160   2              }
 161   1              P10=1;
 162   1      }
 163          void main()
 164          {
 165   1              noVoice();
 166   1              InitT0();
 167   1              InitT1();
 168   1              ET0=1;
 169   1              ET1=1;
 170   1              PT1=1;
 171   1              EA=1;
 172   1              P10=1;
 173   1      
 174   1              myPwm();                                //·½²¨Êä³ö
 175   1              VoiceControl=0;                 //ÉÏµçµÄÊ±ºò£¬Ê°ÒôÆ÷´ò¿ª
C51 COMPILER V9.01   NEWHOST                                                               07/23/2013 14:15:08 PAGE 4   

 176   1              PAshutdown=0;                   //½«¹¦·Å¹Ø±Õ
 177   1              tran_en=0;                              //·¢Éä»ú¹Ø±Õ
 178   1              ModeControl_1=1;        //·¢Éä»úÄ£Ê½ÎªµÍ¹¦ÂÊ
 179   1              MagentControl_1=0;              //¹Ø±Õ´ÅÌú
 180   1              MagentControl_2=1;
 181   1              Delay(27);
 182   1              MagentControl_1=0;              //´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 183   1              MagentControl_2=0;
 184   1              magnetflag=0;
 185   1              
 186   1              Check2=0x3ff;
 187   1              commode2_flag=0;
 188   1              Check1=GetADCResult(5);         //Ê°ÒôÆ÷µÄ¼ì²â
 189   1              Check2=GetADCResult(6);         //µçÁ¿¼ì²â
 190   1              powerflag=0;
 191   1              SensorControl=0;                        //¹Ø±Õ´«¸ĞÆ÷
 192   1      
 193   1              while(1)
 194   1              {
 195   2                      if(Check1>=0x100)       //ÉèÖÃ±È½ÏµçÑ¹£¬´Ë´¦Îª3VÉèÖÃ
 196   2                      {
 197   3                              PAshutdown=0;   //Ê°ÒôÆ÷³¬¹ıÄ³¸öµçÑ¹Ê±£¬´ò¿ª¹¦·Å
 198   3                      }
 199   2                      else
 200   2                      {
 201   3                              PAshutdown=0;   //Ê°ÒôÆ÷Ò»µ©µÍÓÚÄ³¸öµçÑ¹£¬Ôò¹Ø±Õ¹¦·Å
 202   3                      }
 203   2      
 204   2                      if((powerflag==1)&&(Check2<=0x35a))
 205   2                      {
 206   3                              powerflag=0;
 207   3                              PAshutdown=1;
 208   3                              SC_Speech(7);   //µçÑ¹²»³ä×ãÌáÊ¾
 209   3                              Delay(120);
 210   3                              PAshutdown=0;
 211   3                      }
 212   2                      else if((powerflag==0)&&(Check2>=0x377))
 213   2                      {
 214   3                              powerflag=1;
 215   3                              PAshutdown=1;
 216   3                              SC_Speech(6);   //µçÑ¹³ä×ãÌáÊ¾
 217   3                              Delay(120);
 218   3                              PAshutdown=0;
 219   3                      }
 220   2      
 221   2              }
 222   1      }
 223          
 224          void timeT1() interrupt 3       //¶¨Ê±Æ÷1ÖĞ¶Ï½ÓÊÕÊı¾İ
 225          {
 226   1              TH1=timer1H;                    //ÖØ×°ÔØ
 227   1              TL1=timer1L;
 228   1      
 229   1              if(P11==0)                              //Õı³£Çé¿öÎª¸ßµçÆ½,ÓĞµÍµçÆ½ËµÃ÷ÓĞĞÅºÅ
 230   1              {
 231   2                      DataBetween++;
 232   2                      ComFlag=0;
 233   2                      if(DataBetween==150)//µÍµçÆ½³ÖĞøµÄ×î´óÊ±¼ä      
 234   2                      {
 235   3                              DataBetween=0;
 236   3                      }
 237   2              }
C51 COMPILER V9.01   NEWHOST                                                               07/23/2013 14:15:08 PAGE 5   

 238   1              else                                    //Îª¸ßµçÆ½ÁË
 239   1              {
 240   2                      if(ComFlag==0)          //ËµÃ÷ÓĞÒ»¸öµÍµçÆ½
 241   2                      {
 242   3                              ComFlag=1;
 243   3                              if((DataBetween>60)&&(DataBetween<=100))        //µÍµçÆ½³ÖĞøµÄÊ±¼äĞ¡ÓÚ10ms£¬ÔòÎª0
 244   3                              {
 245   4                                      RecData<<=1;
 246   4                                      RecData &= 0xfe;
 247   4                                      DataTime++;
 248   4                                      T1highcount=0;
 249   4                              }
 250   3                              else if((DataBetween>100))                                      //µÍµçÆ½³ÖĞøµÄÊ±¼ä´óÓÚ10ms£¬ÔòÎª1
 251   3                              {
 252   4                                      RecData<<=1;
 253   4                                      RecData |= 0x01;
 254   4                                      DataTime++;
 255   4                                      T1highcount=0;
 256   4                              }
 257   3                              else
 258   3                              {
 259   4                                      T1highcount++;  
 260   4                              }
 261   3      
 262   3                              DataBetween=0;
 263   3                      }
 264   2                      else
 265   2                      {
 266   3                              T1highcount++;
 267   3                              if(T1highcount>=150)
 268   3                              {
 269   4                                      DataTime=0;
 270   4                                      ComFlag=1;
 271   4                                      count=0;
 272   4                              }               
 273   3                      }
 274   2              }
 275   1      
 276   1              if(DataTime==8)                                 //ËµÃ÷Ò»¸ö×Ö½ÚµÄÊı¾İÒÑ¾­½ÓÊÜÍêÈ«
 277   1              {
 278   2                      DataTime=0;
 279   2                      myTxRxData[count]=RecData;
 280   2                      if(count==0&&myTxRxData[0]==CmdHead)
 281   2                      {
 282   3                              count=1;
 283   3                      }
 284   2                      else if(count==1&&myTxRxData[1]==MyAddress)
 285   2                      {
 286   3                              count=2;
 287   3                      }
 288   2                      else if(count>=2&&count<=5)
 289   2                      {
 290   3                              count++;
 291   3                      }
 292   2                      else if(count==6)
 293   2                      {
 294   3                          receiveFlag=1;
 295   3                              count=0;
 296   3                      }
 297   2                      else 
 298   2                      {
 299   3                              count=0;
C51 COMPILER V9.01   NEWHOST                                                               07/23/2013 14:15:08 PAGE 6   

 300   3                      }
 301   2              }
 302   1      
 303   1              if(receiveFlag==1)
 304   1              {
 305   2                      receiveFlag=0;
 306   2                      switch(myTxRxData[2])                           //¶ÔÊı¾İÖ¡ÀïµÄÃüÁî½øĞĞ´¦Àí
 307   2                      {
 308   3                              case ComMode_1:                                 //¸½»ú·¢ËÍ¹ıÀ´µÄÖ»ÓÃÄ£Ê½1£¬ËµÃ÷ÏÖÔÚÊÇÕı³£µÄ£¬Êı¾İ²¿·ÖÎªÊı×éµÄµÚÒ»ºÍµÚ¶ş¸ö×Ö½Ú£¬ÎªÃ
             -ÜÂë±íÄÚµÄÕâ¸ö±àÂëµÄ¿ªÊ¼×Ö½ÚµÄÄÇ¸öµØÖ·£¬È»ºóÌî³äÊı¾İÖ¡£¬°ÑÃÜÂë±íµÄÊı¾İ·¢ËÍ³öÈ¥
 309   3                              {
 310   4                                      ComMode_22_Data();                      //»Ø¸´È·ÈÏĞÅºÅ
 311   4                                      alarmFlag=0;                            //¹Ø±¨¾¯±êÖ¾Î»
 312   4                                      alarmCount=0;                           //±¨¾¯¼ÆÊı´ÎÊıÇåÁã
 313   4                                      commode2_flag=0;                        //¹Ø±Õ±àÂë2ĞÅºÅµÄ·¢ËÍ
 314   4                                      SensorControl=0;                        //¹Ø±ÕÈıÖá´«¸ĞÆ÷
 315   4                                      downUpFlag=0;                           //¹Øµ¹µØ¡¢Ì§Æğ¼ì²â
 316   4                                                              
 317   4                                      if(magnetflag==0)
 318   4                                      {
 319   5                                              MagentControl_1=1;              //¿ªÆô´ÅÌú
 320   5                                              MagentControl_2=0;
 321   5                                              Delay(27);
 322   5                                              MagentControl_1=0;              //´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 323   5                                              MagentControl_2=0;
 324   5                                              magnetflag=1;
 325   5                                      }
 326   4                                      TestFlag=0;     
 327   4                                      
 328   4                                      if(ModeFlag==3||ModeFlag==2)
 329   4                                      {
 330   5                                              ModeFlag=1;
 331   5                                      }
 332   4                              }
 333   3                              break;
 334   3                      }
 335   2              }
 336   1      }
 337          
 338          void time0() interrupt 1                        //×÷ÎªÕû¸öÏµÍ³×Ô¼ºµÄÊ±ÖÓ
 339          {
 340   1              TH0=timer0H;                                    //ÖØ×°ÔØ
 341   1              TL0=timer0L;
 342   1              time0Count_3++;
 343   1      
 344   1              if(time0Count_3>=60)                    //´®¿ÚÃ¿3S½ÓÊÜÒ»´ÎµÄÊı¾İµÄÊ±¼ä±êÖ¾
 345   1              {
 346   2                      if(commuFlag==1)                        //ËµÃ÷¿ªÆôÁËÍ¨ĞÅ
 347   2                      {
 348   3                              TestFlag++;
 349   3                              if(TestFlag==3&&ModeFlag==1)            //ËµÃ÷Ã»ÓĞ½ÓÊÕµ½Êı¾İÒÑ¾­ÓĞ3´ÎÁË£¬¸½»úÒÑ¾­³öÁË3M£¬ÏÖÔÚ¾ÍÒª¼Ó´ó¹¦ÂÊ£¬ÇĞ»»µ½
             -Ä£Ê½2,30MÔÙ¿´ÄÜ²»ÄÜ½ÓÊÕµ½Êı¾İ
 350   3                              {
 351   4                                      TestFlag=5;
 352   4                                      if(ModeFlag==1)
 353   4                                      {
 354   5                                              if(magnetflag==1)
 355   5                                              {
 356   6                                                      MagentControl_1=0;              //¿ªÆô´ÅÌú
 357   6                                                      MagentControl_2=1;
 358   6                                                      Delay(27);
 359   6                                                      MagentControl_1=0;              //´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
C51 COMPILER V9.01   NEWHOST                                                               07/23/2013 14:15:08 PAGE 7   

 360   6                                                      MagentControl_2=0;
 361   6                                                      magnetflag=0;
 362   6                                              }
 363   5                                              SensorControl=1;                        //¿ªÆôÈıÖá´«¸ĞÆ÷
 364   5                                              downUpFlag=1;                           //¿ªÆôµ¹µØ¡¢Ì§Æğ±êÖ¾
 365   5                                              ModeFlag=2;
 366   5                                              commode2_flag=1;
 367   5                                      }       
 368   4                              }
 369   3      
 370   3                              if(commode2_flag==1)
 371   3                              {
 372   4                                      ComMode_2_Data();                               //Ïò¸½»ú·¢ËÍ±àÂë2       
 373   4                              }
 374   3                      }
 375   2                      time0Count_3=0;
 376   2                      Check1=GetADCResult(5);                                 //Ê°ÒôÆ÷µÄ¼ì²â
 377   2                      Check2=GetADCResult(6);                                 //µçÁ¿¼ì²â
 378   2              }
 379   1      
 380   1              if(SensorControl==1)                                            //¼ì²âÈıÖá´«¸ĞÆ÷ÊÇ·ñ´ò¿ª
 381   1              {
 382   2                      if(ReceWave==0)                                                 //ËµÃ÷ÓĞ´¥·¢Çé¿ö£¬¿ªÊ¼¼ÆÊ±
 383   2                      {
 384   3                              time0Count_2++;
 385   3                              if(time0Count_2>=10)                            //ËµÃ÷ÒÑ¾­´óÓÚ0.5S
 386   3                              {
 387   4                                      time0Count_2 =0;                                //¼ÆÊ±ÆÚÇåÁã
 388   4                                      SensorCount++;                                  //ÈıÖá´«¸ĞÆ÷Âö³å¼ÆÊı¼Ó1
 389   4                                      alarmFlag2=1;
 390   4                              }               
 391   3                      }
 392   2                      else if(ReceWave==1&&SensorCount!=0)    //ËµÃ÷ÒÑ¾­ÓĞÒ»¸öÓĞÓÃµÄÂö³å
 393   2                      {
 394   3                              time0Count_1++;
 395   3                              if(time0Count_1>=200)                           //´óÓÚ10S
 396   3                              {
 397   4                                      SensorCount=0;
 398   4                              }
 399   3                      }
 400   2              }
 401   1       
 402   1              if(ModeFlag==2&&SensorCount>=1)                         //ÈıÖá´«¸ĞÆ÷Âö³åµÄÏàÓ¦±¨¾¯
 403   1              {
 404   2                      if(SensorCount==1&&alarmFlag2==1)               //ÈıÖá´«¸ĞÆ÷Ò»´Î´¥·¢,alarmFlag2¿ØÖÆ·¢Éù1´Î
 405   2                      {                                       
 406   3                              VoiceControl=0;                                         //Ê¹ÓÃÓïÒôÊ±Òª¹Ø±ÕÊ°ÉùÆ÷
 407   3                              PAshutdown=1;                                           //ÏÈ¹Ø±ÕÊ°ÒôÆ÷£¬È»ºó´ò¿ª¹¦·Å
 408   3                              SC_Speech(1);                                           //ÓïÒôÌáÊ¾
 409   3                              Delay(140);
 410   3                              PAshutdown=0;                                           //ÓïÒôÍê³Éºó£¬¹Ø±Õ¹¦·Å£¬È»ºó´ò¿ªÊ°ÒôÆ÷
 411   3                              VoiceControl=1;                                         //¿ªÆôÊ°ÉùÆ÷
 412   3                              alarmFlag2=0;
 413   3                      }
 414   2                      if(SensorCount>=2)                                              //ÈıÖá´«¸ĞÆ÷Ò»´Î´¥·¢
 415   2                      {
 416   3                              ModeFlag=3;                                                     //ÈıÖá´«¸ĞÆ÷ÒÑ¾­ÓĞ3´Î´¥·¢ÁË£¬Òª¸Ä±ä·¢ÉäÄ£Ê½ÁË
 417   3                              alarmFlag=1;                                            //ÖÃÓïÒô±¨¾¯Î»
 418   3                              alarmFlag2=0;
 419   3                              SensorCount=0;                                          //Âö³å¼ÆÊıÇåÁã
 420   3                              Delay(1);
 421   3                              commode2_flag=0;                                        //²»·¢ËÍ±àÂë2ÁË
C51 COMPILER V9.01   NEWHOST                                                               07/23/2013 14:15:08 PAGE 8   

 422   3                              ComMode_3_Data();                                       //Ïò¸½»ú·¢ËÍ±àÂë3
 423   3                      }
 424   2              }
 425   1      
 426   1              if(ModeFlag==3)
 427   1              {
 428   2                      if(alarmFlag==1)
 429   2                      {
 430   3                              VoiceControl=0;                 //Ê¹ÓÃÓïÒôÊ±Òª¹Ø±ÕÊ°ÉùÆ÷
 431   3                              PAshutdown=1;
 432   3                              SC_Speech(3);                   //¹Ø»úÓïÑÔÌáĞÑ
 433   3                              Delay(120);
 434   3                              PAshutdown=0;
 435   3                              VoiceControl=1;                 //¿ªÆôÊ°ÉùÆ÷
 436   3                      }
 437   2                      if(alarmFlag==1)
 438   2                      {
 439   3                              VoiceControl=0;                 //Ê¹ÓÃÓïÒôÊ±Òª¹Ø±ÕÊ°ÉùÆ÷
 440   3                              PAshutdown=1;
 441   3                              SC_Speech(4);                   //¹Ø»úÓïÑÔÌáĞÑ
 442   3                              Delay(190);
 443   3                              PAshutdown=0;
 444   3                              VoiceControl=1;                 //¿ªÆôÊ°ÉùÆ÷
 445   3                      }
 446   2                      if(ModeFlag==3)
 447   2                      {
 448   3                              ComMode_3_Data();               //Ïò¸½»ú·¢ËÍ±àÂë3
 449   3                      }
 450   2                      if(alarmFlag==1)
 451   2                      {
 452   3                              VoiceControl=0;                 //Ê¹ÓÃÓïÒôÊ±Òª¹Ø±ÕÊ°ÉùÆ÷
 453   3                              PAshutdown=1;
 454   3                              SC_Speech(3);                   //¹Ø»úÓïÑÔÌáĞÑ
 455   3                              Delay(120);
 456   3                              PAshutdown=0;
 457   3                              VoiceControl=1;                 //¿ªÆôÊ°ÉùÆ÷
 458   3                      }
 459   2                      if(alarmFlag==1)
 460   2                      {
 461   3                              VoiceControl=0;                 //Ê¹ÓÃÓïÒôÊ±Òª¹Ø±ÕÊ°ÉùÆ÷
 462   3                              PAshutdown=1;
 463   3                              SC_Speech(11);                  //¹Ø»úÓïÑÔÌáĞÑ
 464   3                              Delay(190);
 465   3                              PAshutdown=0;
 466   3                              VoiceControl=1;                 //¿ªÆôÊ°ÉùÆ÷
 467   3                      }
 468   2                      if(ModeFlag==3)
 469   2                      {
 470   3                              ComMode_3_Data();               //Ïò¸½»ú·¢ËÍ±àÂë3
 471   3                      }
 472   2                      if(alarmCount>=20)                      //µ÷½ÚÓïÒôµÄ¶ÎÊı
 473   2                      {
 474   3                              alarmCount=0;                   //Çå±¨¾¯¼ÆÊıÆ÷
 475   3                              alarmFlag=0;                    //Çå±¨¾¯±êÖ¾
 476   3                      }
 477   2                      alarmCount++;
 478   2              }
 479   1      }
 480          
 481          void ComMode_1_Data()                           //·¢ËÍ±àÂë1
 482          {
 483   1              unsigned char i,n;
C51 COMPILER V9.01   NEWHOST                                                               07/23/2013 14:15:08 PAGE 9   

 484   1              ModeControl_1=1;                                //Ğ¡¹¦ÂÊ·¢ÉäÄ£Ê½                                
 485   1              tran_en=1;
 486   1              myTxRxData[0]=CmdHead;
 487   1              myTxRxData[1]=MyAddress;
 488   1              myTxRxData[2]=ComMode_1;
 489   1              myTxRxData[3]=0x00;
 490   1              myTxRxData[4]=0x00;
 491   1              myTxRxData[5]=0x00;
 492   1              myTxRxData[6]=0x00;
 493   1      
 494   1              initsignal2();                                                                                                     
 495   1      
 496   1              for(i=0;i<7;i++)
 497   1              {
 498   2                      for(n=0;n<8;n++)
 499   2                      {
 500   3                              if((myTxRxData[i]&0x80)==0x80)                  //Îª1
 501   3                              {
 502   4                                      P10=0;
 503   4                                      Delay3(120);                                            //ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 504   4                              }
 505   3                              else                                                                    //Îª0µÄÇé¿ö
 506   3                              {
 507   4                                      P10=0;
 508   4                                      Delay3(80);                                                     //ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 509   4                              }
 510   3                              P10=1;                                                                  //³£Ì¬Îª¸ßµçÆ½
 511   3                              myTxRxData[i]<<=1;
 512   3                              Delay3(50);                                                             //ÑÓÊ±Òª´óÓÚ2ms
 513   3                      }
 514   2              }
 515   1              tran_en=0;
 516   1      }
 517          
 518          void ComMode_2_Data()                                                           //·¢ËÍ±àÂë2
 519          {
 520   1              unsigned char i,n;
 521   1              ModeControl_1=0;                                                                //Ğ¡¹¦ÂÊ
 522   1              tran_en=1;
 523   1              myTxRxData[0]=CmdHead;
 524   1              myTxRxData[1]=MyAddress;
 525   1              myTxRxData[2]=0xc2;
 526   1              myTxRxData[3]=0x00;
 527   1              myTxRxData[4]=0x00;
 528   1              myTxRxData[5]=0x00;
 529   1              myTxRxData[6]=0x00;
 530   1      
 531   1              initsignal2();
 532   1              for(i=0;i<7;i++)
 533   1              {
 534   2                      for(n=0;n<8;n++)
 535   2                      {
 536   3                              if((myTxRxData[i]&0x80)==0x80)
 537   3                              {
 538   4                                      P10=0;
 539   4                                      Delay3(120);
 540   4                              }
 541   3                              else
 542   3                              {
 543   4                                      P10=0;
 544   4                                      Delay3(80);
 545   4                              }
C51 COMPILER V9.01   NEWHOST                                                               07/23/2013 14:15:08 PAGE 10  

 546   3                              P10=1;
 547   3                              myTxRxData[i]<<=1;
 548   3                              Delay3(50);
 549   3                      }
 550   2              }
 551   1              tran_en=0;
 552   1      }
 553          
 554          void ComMode_22_Data()
 555          {
 556   1              unsigned char i,n;
 557   1              ModeControl_1=0;
 558   1              tran_en=1;
 559   1              myTxRxData[0]=CmdHead;
 560   1              myTxRxData[1]=MyAddress;
 561   1              myTxRxData[2]=0xc2;
 562   1              myTxRxData[3]=0x00;
 563   1              myTxRxData[4]=0x00;
 564   1              myTxRxData[5]=0x00;
 565   1              myTxRxData[6]=0x00;
 566   1      
 567   1              initsignal();
 568   1              for(i=0;i<7;i++)
 569   1              {
 570   2                      for(n=0;n<8;n++)
 571   2                      {
 572   3                              if((myTxRxData[i]&0x80)==0x80)
 573   3                              {
 574   4                                      P10=0;
 575   4                                      Delay33(120);
 576   4                              }
 577   3                              else
 578   3                              {
 579   4                                      P10=0;
 580   4                                      Delay33(80);
 581   4                              }
 582   3                              P10=1;
 583   3                              myTxRxData[i]<<=1;
 584   3                              Delay33(50);
 585   3                      }
 586   2              }
 587   1              tran_en=0;
 588   1      }
 589          
 590          void ComMode_3_Data()
 591          {
 592   1              unsigned char i,n;
 593   1              ModeControl_1=0;                                                        //´ó¹¦ÂÊ
 594   1              tran_en=1;
 595   1              myTxRxData[0]=CmdHead;
 596   1              myTxRxData[1]=MyAddress;
 597   1              myTxRxData[2]=ComMode_3;
 598   1              myTxRxData[3]=0x00;
 599   1              myTxRxData[4]=0x00;
 600   1              myTxRxData[5]=0x00;
 601   1              myTxRxData[6]=0x00;
 602   1      
 603   1              initsignal2();
 604   1      
 605   1              for(i=0;i<7;i++)
 606   1              {
 607   2                      for(n=0;n<8;n++)
C51 COMPILER V9.01   NEWHOST                                                               07/23/2013 14:15:08 PAGE 11  

 608   2                      {
 609   3                              if((myTxRxData[i]&0x80)==0x80)
 610   3                              {
 611   4                                      P10=0;
 612   4                                      Delay3(120);
 613   4                              }
 614   3                              else
 615   3                              {
 616   4                                      P10=0;
 617   4                                      Delay3(80);
 618   4                              }
 619   3                              P10=1;
 620   3                              myTxRxData[i]<<=1;
 621   3                              Delay3(50);
 622   3                      }
 623   2              }
 624   1              tran_en=0;
 625   1              ModeControl_1=1;                                                //·¢ËÍ±àÂë3Íê³Éºó£¬»»³ÉĞ¡¹¦ÂÊ
 626   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1666    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     60       8
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =     11    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
