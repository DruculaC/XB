C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE NEWHOST
OBJECT MODULE PLACED IN .\out\newHost.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE newHost.c LARGE BROWSE DEBUG OBJECTEXTEND PRINT(.\listing\newHost.lst) OBJE
                    -CT(.\out\newHost.obj)

line level    source

   1          
   2          #include"N79E81x.h"
   3          #include<intrins.h>
   4          #include"AD.h"
   5          #include"UART.h"
   6          #include"T0.h"
   7          #include"voice.h"
   8          #include"pwm.h"
   9          #include"T1.h"
  10          
  11          //¶¨ÒåÍ¨ĞÅÃüÁî
  12          
  13          #define CmdStart 0x00 //¿ª»úÃüÁî
  14          #define CmdStop 0x01  //¹Ø»úÃüÁî
  15          
  16          #define ComMode_1 0xc1 //Í¨ĞÅÄ£Ê½1 
  17          #define ComMode_2 0xc2 //Í¨ĞÅÄ£Ê½2
  18          #define ComMode_3 0xc3 //Í¨ĞÅÄ£Ê½3
  19          #define ComMode_4 0xc4 //Ì§ÆğÖ¸Áî
  20          #define ComMode_5 0xc5//µ¹µØÖ¸Áî
  21          
  22          #define Succeed 0xce  //Í¨ĞÅ³É¹¦
  23          #define Wrong 0xff    //Í¨ĞÅÊ§°Ü
  24          
  25          #define CmdHead 0xc8
  26          #define CmdHead1 0x33 //Êı¾İÖ¡µÄÊ×²¿1, 00110011,11
  27          #define CmdHead2 0xcc //Êı¾İÖ¡µÄÊ×²¿2,11001100,00
  28          #define CmdHead3 0x3c //Êı¾İÖ¡µÄÊ×²¿3,11000011,01
  29          #define CmdHead4 0xcc //Êı¾İÖ¡µÄÊ×²¿4,11001100,00
  30          
  31          #define MyAddress 0xe0
  32          #define MyAddress1 0x33 //±¾»úµØÖ·1, 00110011,11
  33          #define MyAddress2 0x3c //±¾»úµØÖ·2, 11000011,01
  34          #define MyAddress3 0xcc //±¾»úµØÖ·3,11001100,00
  35          #define MyAddress4 0xcc //±¾»úµØÖ·4,11001100,00
  36          
  37          //ÈıÂ·Ñ­»·
  38          //sbit onePin=P1^6;
  39          //sbit twoPin=P1^7;
  40          
  41          
  42          //Ö÷»úµÄ·¢Éä²¿·ÖµÄ¿ØÖÆ¶Ë¿Ú
  43          //sbit PWMout=P0^1;//·¢Éä»úµÄ·½²¨Êä³ö¿Ú£¬Ê¹ÓÃÍâÉèPWM
  44          sbit ModeControl_1=P2^6;//·¢Éä»úÄ£Ê½¿ØÖÆ,0ÁÁÎª30MÄ£Ê½£¬1ÃğÎª300MÄ£Ê½
  45          //sbit ModeTurn=P2^7;//·¢Éä»ú¿ª¹Ø£¬1ÁÁÎª¿ªÁË£¬0ÃğÎª¹ØÁË
  46          
  47          //½ÓÊÕ»ú¿ØÖÆ
  48          sbit SwitchControl=P1^3;//1ÓĞĞ§£¬0¹Ø±Õ
  49          
  50          //ÈıÖá´«¸ĞÆ÷
  51          sbit ReceWave=P0^7;//ÈıÖá´«¸ĞÆ÷ÊäÈë¶Ë
  52          sbit SensorControl=P2^5;//ÈıÖá´«¸ĞÆ÷¿ØÖÆ¶Ë
  53          //²â¾à´«¸ĞÆ÷´ò¿ªÒ»´Î£¬Ïàµ±ÓÚÆğÊ¼ĞÅºÅ£¬Ò»´Î¸ßÂö³å¼´´ò¿ªÒ»´Î
  54          sbit sensor_on=P0^0;
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 2   

  55          
  56          //µç´ÅÌú
  57          sbit MagentControl_1=P2^2;
  58          sbit MagentControl_2=P2^3;
  59          
  60          //Ê°ÒôÆ÷¿ØÖÆ ADµÄ6ºÅÍ¨µÀÎªÊ°ÒôÆ÷µÄÒôÁ¿¼ì²é¶Ë
  61          sbit VoiceControl=P2^4;//Ê°ÒôÆ÷¿ØÖÆ¶Ë
  62          
  63          sbit upSignal=P0^4;//Ì§ÆğĞÅºÅ
  64          sbit downSignal=P0^3;//µ¹µØĞÅºÅ
  65          
  66          //µç³Ø¿ØÖÆ      ADµÄ1ºÅÍ¨µÀÎªµç³ØµÄµçÁ¿¼ì²â¶Ë£¬¿ØÖÆ³äµç¿ª¹Ø£¬0Îª³äµç£¬1Îª²»³äµç
  67          sbit BatteryControl=P1^2;
  68          
  69          unsigned char count=0;//Êı¾İ½ÓÊÕ²¿·ÖµÄ¼ÆÊıÆ÷
  70          
  71          unsigned int lastAddr=0;//ÉÏÒ»´Î½ÓÊÕµ½µÄ±àÂëµÄµØÖ·
  72          
  73          unsigned int time0Count_1=0;//×÷ÎªÈıÖá´«¸ĞÆ÷Á½¸öÂö³åÖ®¼äµÄÊ±¼ä¼ä¸ô¼ÆÊ±
  74          unsigned int time0Count_2=0;//×÷ÎªÈıÖá´«¸ĞÆ÷µÄ¼ÆÊ±
  75          unsigned int time0Count_3=0;//¶¨Ê±Æ÷T0µÄ¼ÆÊı
  76          unsigned int time0Count_4=0;//×÷ÎªÌ§ÆğÂö³åµÄÊ±¼ä¼ä¸ô¼ÆÊ±
  77          unsigned int time0Count_5=0;//×÷Îªµ¹µØÂö³åµÄÊ±¼ä¼ä¸ô¼ÆÊ±
  78          
  79          bit SensorFlag=0; //ÈıÖá´«¸ĞÆ÷µÄµÍµçÆ½±êÖ¾Î»
  80          unsigned char  SensorCount=0; //×÷ÎªÈıÖá´«¸ĞÆ÷Âö³åµÄ¼ÆÊı
  81          
  82          unsigned char TestFlag=0;       //1¡¢2¡¢3·Ö±ğÎªÃ¿´Î½ÓÊÕµ½¸½»ú·¢ËÍÀ´Êı¾İºóµÄ¼ÆÊı£¬ÔÚ´®¿ÚµÄ³É¹¦Ö¸ÁîÀï»áÖ´ĞĞ½«È¥¹éÁ
             -ãµÄ²Ù×÷
  83                                                  //Èç¹ûÁ¬Ğø3´Î¶¼Ã»ÓĞ¹éÁã£¬ÔòËµÃ÷²»ÔÚ³¡ÁË
  84          unsigned char ModeFlag=1;       //Ä£Ê½Ñ¡ÔñÎ»£¬1ÔòÓÃÄ£Ê½1,2ÔòÓÃÄ£Ê½2,3ÔòÎªÄ£Ê½3
  85          
  86          bit alarmFlag=0;//±¨¾¯ÓïÒôµÄ¿ªÆô±êÖ¾
  87          bit alarmFlag2=0;//±¨¾¯ÓïÒô±êÖ¾2
  88          unsigned char alarmCount=0;//±¨¾¯ÓïÒôµÄ´ÎÊı
  89          
  90          bit threeFlag=0;//ÈıÂ·Ñ­»·¿ª¹Ø±êÖ¾
  91          
  92          bit voiceFlag=0;
  93          bit downUpFlag=0;  //µ¹µØºÍÌ§Æğ¼ì²â±êÖ¾
  94          
  95          bit downFlag=0;//µ¹µØµÄ±êÖ¾
  96          bit upFlag=0;//Ì§ÆğµÄ±êÖ¾
  97          bit downFlagSend=0;//µ¹µØ·¢ËÍµÄ±êÖ¾
  98          bit upFlagSend=0;//Ì§Æğ·¢ËÍµÄ±êÖ¾
  99          
 100          //×÷Îª½ÓÊÕºÍ·¢ËÍµÄ»º´æÇø
 101          unsigned char TxRxBuf[28]={0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
             -,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
 102          
 103          //Ò»¸öÍ·×Ö½Ú£¬Ò»¸öµØÖ·×Ö½Ú£¬Ò»¸öÃüÁî×Ö½Ú£¬Á½¸ö±àÂëµØÖ·×Ö½Ú£¬Á½¸ö±àÂë
 104          unsigned char myTxRxData[7]={0x00,0x00,0x00,0x00,0x00,0x00,0x00};//´¦ÀíÍêºóµÄÍ¨ĞÅÊı¾İµÄ»º³åÇø
 105          
 106          unsigned int Check2=0;//µçÁ¿¼ì²â
 107          unsigned char Check1=0;//×÷ÎªAD¼ì²âÖµ£¬Ê°ÒôÆ÷¼ì²â£¬Æ½Ê±ÔëÉùÎª1VÒÔÄÚ£¬ÓĞĞÅºÅÊ±Îª1.5V
 108          
 109          bit receiveFlag=0;//½ÓÊÕµ½Êı¾İ±êÖ¾
 110          bit commuFlag=0;//¿ªÆôÍ¨ĞÅ±êÖ¾
 111          
 112          unsigned char DataBetween=0;//×÷Îª½ÓÊÕÊı¾İµÄÖĞ¼ä±äÁ¿
 113          unsigned char RecData=0;//½ÓÊÕµ½µÄÊı¾İ
 114          unsigned char DataTime=0;//×÷Îª½ÓÊÕµÄÊı¾İµÄÒÆÎ»´ÎÊı¼ÆÊı
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 3   

 115          bit ComFlag=1;//×öÉÏÉıÑØµÄÒ»¸ö±êÖ¾
 116          //unsigned int newAddr=0;
 117          unsigned char T1highcount=0;       //¶¨Ê±Æ÷T1ÔÚÃ»ÓĞĞÅºÅµ½À´µÄÊ±ºò£¬¶Ô¸ßµçÆ½¼ÆÊı£¬Ò»µ©³¬¹ıÄ³¸öÖµ£¬Ôò½«Datatime
             -Çå0
 118          //unsigned char T1highcount2=0;         //µ±P11ÎªµÍµçÆ½Ê±£¬ÀïÃæµÄ¸ßµçÆ½¼ÆÊı
 119          
 120          //¹¦·Å¿ª¹Ø¿ØÖÆ£¬1Îª´ò¿ª¹¦·Å£¬0Îª¹Ø±Õ¹¦·Å
 121          sbit PAshutdown=P1^4;
 122          
 123          //¶¨Òåµç´ÅÌú×ª¶¯Óë·ñ
 124          unsigned char magnetflag=0;
 125          
 126          //¶¨ÒåÒ»¸ö¼ÆÊı£¬À´±íÊ¾ĞÅºÅ½ÓÊÕºó£¬¶à³¤Ê±¼äÊ¹½ÓÊÕ»ú´ò¿ª£¬¼´¿ØÖÆSwitchControlµÄ¸ßµçÆ½Ê±¼ä¡£
 127          unsigned int SwitchControlcount=0;
 128          
 129          //¶¨ÒåÒ»¸ö±êÊ¶Î»£¬±íÊ¾¿ª»úÒ»´Î£¬¹Ø»úÒ»´Î
 130          unsigned char turnflag=0;
 131          
 132          //¶¨ÒåµçÑ¹±¨¾¯±êÖ¾Î»
 133          unsigned char powerflag=1;
 134          
 135          //·¢ËÍ±àÂëĞÅºÅ±êÖ¾Î»
 136          unsigned char commode2_flag=0; //·¢ËÍ±àÂë2µÄ±êÖ¾Î»
 137          //unsigned char commode3_flag=0; //·¢ËÍ±àÂë3µÄ±êÖ¾Î»
 138          
 139          //º¯ÊıÉùÃ÷
 140          void ComMode_1_Data(void);      //·¢ËÍÄ£Ê½1±àÂë
 141          void ComMode_2_Data(void);//·¢ËÍÄ£Ê½2±àÂë
 142          void ComMode_22_Data(void);//·¢ËÍÄ£Ê½2±àÂë
 143          void ComMode_3_Data(void);//·¢ËÍÄ£Ê½3±àÂë
 144          void ComMode_4_Data(void);//·¢ËÍÌ§Æğ±àÂë
 145          void ComMode_5_Data(void);//·¢ËÍµ¹µØ±àÂë
 146          
 147          //void codeData(unsigned char *doData,unsigned char len);               //±àÂë ,µçÆ½1±äÎª0011£¬µçÆ½0±äÎª1100
 148          //void transCode(unsigned char *doData,unsigned char len);//½âÂë£¬½«½ÓÊÕµ½µÃÊı¾İ»¹Ô­
 149          
 150          //t=1Ê±£¬ÑÓ³Ù100us×óÓÒ
 151          void Delay3(unsigned int t)
 152          {
 153   1              unsigned int i,j;
 154   1              for(i=0;i<t;i++)                
 155   1              for(j=0;j<19;j++);
 156   1      }
 157          
 158          void Delay33(unsigned int t)
 159          {
 160   1              unsigned int i,j;
 161   1              for(i=0;i<t;i++)                
 162   1              for(j=0;j<26;j++);
 163   1      }
 164          
 165          //init signal£¬·¢ËÍ±àÂëĞÅºÅÇ°µÄÆğÊ¼ĞÅºÅ£¬ÓÃÓÚ½«½ÓÊÕ»úµÄ×Ô¶¯ÔöÒæ´ò¿ª
 166          void initsignal()
 167          {
 168   1              unsigned char k,k1;
 169   1              unsigned char mystartbuffer=0xb4;
 170   1              for(k1=0;k1<8;k1++)
 171   1              {
 172   2                      for(k=0;k<8;k++)
 173   2                      {
 174   3                              if((mystartbuffer&0x80)==0x80)//Îª1
 175   3                              {
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 4   

 176   4                                      P10=0;
 177   4                                      Delay3(300);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 178   4                              }
 179   3                              else//Îª0µÄÇé¿ö
 180   3                              {
 181   4                                      P10=0;
 182   4                                      Delay3(300);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 183   4                              }
 184   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 185   3                              mystartbuffer<<=1;
 186   3                              Delay3(100);//ÑÓÊ±Òª´óÓÚ2ms
 187   3                      }
 188   2                      mystartbuffer=0xaa;
 189   2                      Delay3(50);
 190   2              }
 191   1              P10=1;
 192   1      //      Delay3(80);
 193   1      }
 194          
 195          void initsignal2()
 196          {
 197   1              unsigned char k,k1;
 198   1              unsigned char mystartbuffer=0xb4;
 199   1              for(k1=0;k1<8;k1++)
 200   1              {
 201   2                      for(k=0;k<8;k++)
 202   2                      {
 203   3                              if((mystartbuffer&0x80)==0x80)//Îª1
 204   3                              {
 205   4                                      P10=0;
 206   4                                      Delay3(205);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 207   4                              }
 208   3                              else//Îª0µÄÇé¿ö
 209   3                              {
 210   4                                      P10=0;
 211   4                                      Delay3(205);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 212   4                              }
 213   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 214   3                              mystartbuffer<<=1;
 215   3                              Delay3(70);//ÑÓÊ±Òª´óÓÚ2ms
 216   3                      }
 217   2                      mystartbuffer=0xaa;
 218   2                      Delay3(35);
 219   2              }
 220   1              P10=1;
 221   1      //      Delay3(80);
 222   1      }
 223          void main()
 224          {
 225   1      //      unsigned int newAddr=0;
 226   1      
 227   1              noVoice();
 228   1      
 229   1      //      InitUART();
 230   1              InitT0();
 231   1              InitT1();
 232   1      //      TI=0;
 233   1      //      RI=0;
 234   1      
 235   1      //      SwitchControl=1;         //¿ªÆğ½ÓÊÕ»ú£¬¿ØÖÆ¶ËÎªµÍµçÆ½
 236   1      
 237   1      //      onePin=0;
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 5   

 238   1      //      twoPin=0;
 239   1              sensor_on=0;
 240   1      
 241   1      //      upSignal=1;
 242   1      //      downSignal=1;
 243   1      
 244   1      //      ES=1;
 245   1              ET0=1;
 246   1              ET1=1;
 247   1      //      PS=1;
 248   1              PT1=1;
 249   1              EA=1;
 250   1              P10=1;
 251   1      //      P11=1;
 252   1      
 253   1              BatteryControl=0;       //¸½»úÉÏµçµÄÊ±ºòÖÃ0£¬¼´¿ÉÒÔ³äµç£¬µç³ØÔÚÃ»ÓĞ³äÂúµÄÇé¿öÏÂÎªµÍµçÆ½
 254   1              myPwm();        //¿ª·¢Éä»ú
 255   1              VoiceControl=1;   //ÉÏµçµÄÊ±ºò£¬Ê°ÒôÆ÷´ò¿ª
 256   1              PAshutdown=0;           //½«¹¦·Å¹Ø±Õ
 257   1      
 258   1              MagentControl_1=0;//¹Ø±Õ´ÅÌú
 259   1              MagentControl_2=1;
 260   1              Delay(27);
 261   1              MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 262   1              MagentControl_2=0;
 263   1              magnetflag=0;
 264   1              
 265   1              Check2=0x3ff;
 266   1              commode2_flag=0;
 267   1              Check1=GetADCResult(5);         //Ê°ÒôÆ÷µÄ¼ì²â
 268   1              Check2=GetADCResult(6);         //µçÁ¿¼ì²â
 269   1              powerflag=0;
 270   1              turnflag=0;
 271   1      
 272   1              SensorControl=0;
 273   1      
 274   1              while(1)
 275   1              {
 276   2      //              Delay(500);
 277   2                      if(Check1>=0x100)//ÉèÖÃ±È½ÏµçÑ¹£¬´Ë´¦Îª3VÉèÖÃ
 278   2                      {
 279   3                              PAshutdown=1;   //Ê°ÒôÆ÷³¬¹ıÄ³¸öµçÑ¹Ê±£¬´ò¿ª¹¦·Å
 280   3                      }
 281   2                      else
 282   2                      {
 283   3                              PAshutdown=0;   //Ê°ÒôÆ÷Ò»µ©µÍÓÚÄ³¸öµçÑ¹£¬Ôò¹Ø±Õ¹¦·Å
 284   3                      }
 285   2      
 286   2                      if(Check2>=0x377) //±íÊ¾µç³Ø³ä°üÁË
 287   2                      {
 288   3                              BatteryControl=1;//¿ªÂ©Ä£Ê½£¬ÕâÑùÎª¸ß×èÌ¬       
 289   3                      }
 290   2                      else
 291   2                      {
 292   3                              BatteryControl=0;//µç³ØÔÚÃ»ÓĞ³äÂúµÄÇé¿öÏÂÎªµÍµçÆ½
 293   3                      }
 294   2      /*
 295   2                      if(turnflag==1)
 296   2                      {
 297   2                              if(Check2<=0x300)
 298   2                              {
 299   2                                      PAshutdown=1;
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 6   

 300   2                                      SC_Speech(8);   //µçÑ¹²»³ä×ãÌáÊ¾
 301   2                                      Delay(120);
 302   2                                      PAshutdown=0;
 303   2                                      powerflag=0;
 304   2                              }
 305   2                              else if(Check2>=0x390)
 306   2                              {
 307   2                                      PAshutdown=1;
 308   2                                      SC_Speech(7);   //µçÑ¹³ä×ãÌáÊ¾
 309   2                                      Delay(120);
 310   2                                      PAshutdown=0;
 311   2                                      powerflag=1;
 312   2                              }
 313   2                              turnflag=0;     
 314   2                      }
 315   2                      
 316   2                      if(Check2<=0x300)
 317   2                      {
 318   2      //                      powerflag=0;
 319   2                              PAshutdown=1;
 320   2                              SC_Speech(8);   //µçÑ¹²»³ä×ãÌáÊ¾
 321   2                              Delay(120);
 322   2                              PAshutdown=0;
 323   2                      }
 324   2                      else if(Check2>=0x390)
 325   2                      {
 326   2      //                      powerflag=1;
 327   2                              PAshutdown=1;
 328   2                              SC_Speech(7);   //µçÑ¹³ä×ãÌáÊ¾
 329   2                              Delay(120);
 330   2                              PAshutdown=0;
 331   2                      }
 332   2      */
 333   2      //              if(SwitchControlcount==18000)
 334   2      //              {
 335   2      //                      SwitchControl=0;
 336   2      //                      SwitchControlcount=0;   
 337   2      //              }
 338   2              }
 339   1      }
 340          
 341          void timeT1() interrupt 3 //¶¨Ê±Æ÷1ÖĞ¶Ï½ÓÊÕÊı¾İ
 342          {
 343   1      //      unsigned int newAddr=0;
 344   1              TH1=timer1H;//ÖØ×°ÔØ
 345   1              TL1=timer1L;
 346   1      
 347   1      //      if(SwitchControl==1)
 348   1      //      {
 349   1      //              SwitchControlcount++;
 350   1      //      }
 351   1      //      else
 352   1      //      {
 353   1              if(P11==0)//Õı³£Çé¿öÎª¸ßµçÆ½,ÓĞµÍµçÆ½ËµÃ÷ÓĞĞÅºÅ
 354   1              {
 355   2                      DataBetween++;
 356   2                      ComFlag=0;
 357   2                      if(DataBetween==150)//µÍµçÆ½³ÖĞøµÄ×î´óÊ±¼ä      
 358   2                      {
 359   3                              DataBetween=0;
 360   3                      }
 361   2              }
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 7   

 362   1              else//Îª¸ßµçÆ½ÁË
 363   1              {
 364   2                      if(ComFlag==0)//ËµÃ÷ÓĞÒ»¸öµÍµçÆ½
 365   2                      {
 366   3                              ComFlag=1;
 367   3      //                              RecData<<=1;
 368   3      
 369   3                              if((DataBetween>60)&&(DataBetween<=100))        //µÍµçÆ½³ÖĞøµÄÊ±¼äĞ¡ÓÚ10ms£¬ÔòÎª0
 370   3                              {
 371   4                                      RecData<<=1;
 372   4                                      RecData &= 0xfe;
 373   4                                      DataTime++;
 374   4                                      T1highcount=0;
 375   4                              }
 376   3                              else if((DataBetween>100))//µÍµçÆ½³ÖĞøµÄÊ±¼ä´óÓÚ10ms£¬ÔòÎª1
 377   3                              {
 378   4                                      RecData<<=1;
 379   4                                      RecData |= 0x01;
 380   4                                      DataTime++;
 381   4                                      T1highcount=0;
 382   4                              }
 383   3                              else
 384   3                              {
 385   4                                      T1highcount++;  
 386   4                              }
 387   3      
 388   3                              DataBetween=0;
 389   3      //                              DataTime++;
 390   3                      }
 391   2                      else
 392   2                      {
 393   3                              T1highcount++;
 394   3                              if(T1highcount>=150)
 395   3                              {
 396   4                                      DataTime=0;
 397   4                                      ComFlag=1;
 398   4                                      count=0;
 399   4                              }               
 400   3                      }
 401   2              }
 402   1      //      P01=~P01;
 403   1      
 404   1              if(DataTime==8)//ËµÃ÷Ò»¸ö×Ö½ÚµÄÊı¾İÒÑ¾­½ÓÊÜÍêÈ«
 405   1              {
 406   2                      DataTime=0;
 407   2                      myTxRxData[count]=RecData;
 408   2                      if(count==0&&myTxRxData[0]==CmdHead)
 409   2                      {
 410   3                              count=1;
 411   3                      }
 412   2                      else if(count==1&&myTxRxData[1]==MyAddress)
 413   2                      {
 414   3                              count=2;
 415   3                      }
 416   2                      else if(count>=2&&count<=5)
 417   2                      {
 418   3                              count++;
 419   3                      }
 420   2                      else if(count==6)
 421   2                      {
 422   3                          receiveFlag=1;
 423   3                              count=0;
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 8   

 424   3                      }
 425   2                      else 
 426   2                      {
 427   3                              count=0;
 428   3                      }
 429   2              }
 430   1      
 431   1              if(receiveFlag==1)
 432   1              {
 433   2                      receiveFlag=0;
 434   2                      SwitchControl=1;
 435   2      //              SwitchControl=1;
 436   2      //              transCode(TxRxBuf,0x1c);//½«½ÓÊÕµ½µÃÊı¾İ½âÂë    
 437   2      //              ½âÎöÃüÁî
 438   2                      switch(myTxRxData[2]) //¶ÔÊı¾İÖ¡ÀïµÄÃüÁî½øĞĞ´¦Àí
 439   2                      {
 440   3                              case CmdStart://ÈôÊÇ¿ª»úÖ¸Áî£¬Ö´ĞĞ¿ª»ú²Ù×÷
 441   3                              {
 442   4      //ÔÚÕâÀï¼ÓÈë¿ª»úµÄÊ±ºòÒª×öµÄÊÂÇé
 443   4                                      ModeControl_1=1;        //·¢Éä»úÄ£Ê½¿ØÖÆ¶Ë,¿ª»úÊ±Îª30MÄ£Ê½
 444   4                                  VoiceControl=1;             //¿ª»úÊ±Ö÷»ú¿ªÊ°ÒôÆ÷
 445   4                                      
 446   4                                      if(magnetflag==0)
 447   4                                      {
 448   5                                              MagentControl_1=1;//¿ªÆô´ÅÌú
 449   5                                              MagentControl_2=0;
 450   5                                              Delay(27);
 451   5                                              MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 452   5                                              MagentControl_2=0;
 453   5                                              magnetflag=1;
 454   5                                      }
 455   4      
 456   4                                      SensorControl=0;
 457   4                                      commuFlag=1; //¿ªÆôÍ¨ĞÅ
 458   4                                      turnflag=1;
 459   4                              }
 460   3                              break;
 461   3      
 462   3                              case CmdStop:     //ÈôÊÇ¹Ø»úÖ¸Áî£¬Ö´ĞĞ¹Ø»ú²Ù×÷
 463   3                              {
 464   4      //ÔÚÕâÀï¼ÓÈë¹Ø»úµÄÊ±ºòÒª×öµÄÊÂÇé
 465   4                                      
 466   4                                      VoiceControl=0;//¹Ø±ÕÊ°ÉùÆ÷
 467   4      
 468   4                                      if(magnetflag==1)
 469   4                                      {
 470   5                                              MagentControl_1=0;//¿ªÆô´ÅÌú
 471   5                                              MagentControl_2=1;
 472   5                                              Delay(27);
 473   5                                              MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 474   5                                              MagentControl_2=0;
 475   5                                              magnetflag=0;
 476   5                                      }
 477   4                                      SensorControl=0;//¹Ø±ÕÈıÖá´«¸ĞÆ÷
 478   4      
 479   4                                      commuFlag=0;//¹Ø±ÕÍ¨ĞÅ
 480   4      
 481   4                                      alarmFlag=0;//¹Ø±¨¾¯±êÖ¾Î»
 482   4                                      alarmCount=0;//±¨¾¯¼ÆÊı´ÎÊıÇåÁã
 483   4                                      turnflag=1;
 484   4      
 485   4      //                              VoiceControl=1;//Ê¹ÓÃÓïÒôÊ±Òª¹Ø±ÕÊ°ÉùÆ÷
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 9   

 486   4      //                              SC_Speech(12);  //
 487   4      //                              Delay(100);
 488   4      //      
 489   4      //                              if(Check2>=0x3cf)//ÉèÖÃ±È½ÏµçÑ¹£¬´Ë´¦Îª4V,ÒÔ4.2VÎª»ù×¼
 490   4      //                              {
 491   4      //                                      SC_Speech(10);  //µçÁ¿³ä×ãÌáÊ¾
 492   4      //                                      Delay(100);
 493   4      //                              }
 494   4      //                              else if(Check2<0x3cf&&Check2>=399)
 495   4      //                              {
 496   4      //                                      SC_Speech(9);  //µçÁ¿³ä×ãÌáÊ¾
 497   4      //                                      Delay(100);
 498   4      //                              }
 499   4      //                              else if(Check2<0x399&&Check2>=0x366)
 500   4      //                              {
 501   4      //                                      SC_Speech(8);  //µçÁ¿³ä×ãÌáÊ¾
 502   4      //                                      Delay(100);
 503   4      //                              }
 504   4      //                              else if(Check2<0x366)
 505   4      //                              {
 506   4      //                                      SC_Speech(7);  //µçÁ¿³ä×ãÌáÊ¾
 507   4      //                                      Delay(100);
 508   4      //                              }
 509   4      //
 510   4      //                              VoiceControl=0;//¿ªÆôÊ°ÉùÆ÷
 511   4                              }
 512   3                              break;
 513   3      
 514   3                              case ComMode_1:  //¸½»ú·¢ËÍ¹ıÀ´µÄÖ»ÓÃÄ£Ê½1£¬ËµÃ÷ÏÖÔÚÊÇÕı³£µÄ£¬Êı¾İ²¿·ÖÎªÊı×éµÄµÚÒ»ºÍµÚ¶ş¸ö×Ö½Ú£¬ÎªÃÜÂë±
             -íÄÚµÄÕâ¸ö±àÂëµÄ¿ªÊ¼×Ö½ÚµÄÄÇ¸öµØÖ·£¬È»ºóÌî³äÊı¾İÖ¡£¬°ÑÃÜÂë±íµÄÊı¾İ·¢ËÍ³öÈ¥
 515   3                              {
 516   4      //                                      commode2_flag=1;
 517   4                                      ComMode_22_Data();//»Ø¸´È·ÈÏĞÅºÅ
 518   4                                      alarmFlag=0;//¹Ø±¨¾¯±êÖ¾Î»
 519   4                                      alarmCount=0;//±¨¾¯¼ÆÊı´ÎÊıÇåÁã
 520   4                                      commode2_flag=0;  //¹Ø±Õ±àÂë2ĞÅºÅµÄ·¢ËÍ
 521   4      //                                      commode3_flag=0;
 522   4      
 523   4      //                              lastAddr=newAddr;
 524   4                                      SensorControl=0;        //¹Ø±ÕÈıÖá´«¸ĞÆ÷
 525   4                                      downUpFlag=0;           //¹Øµ¹µØ¡¢Ì§Æğ¼ì²â
 526   4                                                              
 527   4      //                                      if(TestFlag>=3)//ÓĞÒì³£Çé¿ö»Ö¸´Ê±£¬¿ªÆôµç×ÓËø
 528   4      //                                      {
 529   4                                      if(magnetflag==0)
 530   4                                      {
 531   5                                              MagentControl_1=1;//¿ªÆô´ÅÌú
 532   5                                              MagentControl_2=0;
 533   5                                              Delay(27);
 534   5                                              MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 535   5                                              MagentControl_2=0;
 536   5                                              magnetflag=1;
 537   5                                      }
 538   4      //                                      }
 539   4                                      TestFlag=0;     
 540   4                                      
 541   4                                      if(ModeFlag==3||ModeFlag==2)
 542   4                                      {
 543   5                                      //»Ö¸´ÁËÕı³££¬×öÏàÓ¦¸´Î»¶¯×÷
 544   5                                              ModeFlag=1;
 545   5                                      }
 546   4                              }
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 10  

 547   3                              break;
 548   3      /*
 549   3                                      case ComMode_1:  //¸½»ú·¢ËÍ¹ıÀ´µÄÖ»ÓÃÄ£Ê½1£¬ËµÃ÷ÏÖÔÚÊÇÕı³£µÄ£¬Êı¾İ²¿·ÖÎªÊı×éµÄµÚÒ»ºÍµÚ¶ş¸ö×Ö½Ú£¬ÎªÃÜÂë
             -±íÄÚµÄÕâ¸ö±àÂëµÄ¿ªÊ¼×Ö½ÚµÄÄÇ¸öµØÖ·£¬È»ºóÌî³äÊı¾İÖ¡£¬°ÑÃÜÂë±íµÄÊı¾İ·¢ËÍ³öÈ¥
 550   3                                      {
 551   3      
 552   3      
 553   3      //                                                      newAddr=(newAddr|myTxRxData[4])<<8;//¸ß°ËÎ»
 554   3      //                                                      newAddr=newAddr+myTxRxData[3];             //µÍ°ËÎ»
 555   3      
 556   3              
 557   3              
 558   3                                                              if(PassWord[lastAddr+1]==myTxRxData[5]&&PassWord[lastAddr+2]==myTxRxData[6])//ÃÜÂë±íÊÇ·ñ¹ö¶¯ÁËÒ»¸öÈ
             -»ºó¶ÔµÄ×¡
 559   3                                                              {
 560   3                                                                      
 561   3      //                                                              if(newAddr==0 &&( (lastAddr-newAddr)>=997 ||(lastAddr-newAddr)==0))
 562   3      //                                                              { 
 563   3                                                                      
 564   3      //                                                              if(newAddr>=999)
 565   3      //                                                              {
 566   3      //                                                                      newAddr=0;
 567   3      //                                                                      lastAddr=newAddr;//±£´æÕâ´ÎµÄÃÜÂëµØÖ·£¬ÎªÏÂ´ÎµØÖ·×öĞ£¶ÔÊ¹ÓÃ
 568   3      //                                                              }
 569   3      //                                                              else 
 570   3      //                                                              {
 571   3      //                                                                      lastAddr=newAddr;//±£´æÕâ´ÎµÄÃÜÂëµØÖ·£¬ÎªÏÂ´ÎµØÖ·×öĞ£¶ÔÊ¹ÓÃ
 572   3      //                                                                      newAddr+=1;//µØÖ·¹ö¶¯Ò»´Î
 573   3      //                                                              }
 574   3      
 575   3                                                                      ComMode_1_Data(newAddr);//»Ø¸´È·ÈÏĞÅºÅ
 576   3                                                                      
 577   3              
 578   3                                                                      alarmFlag=0;//¹Ø±¨¾¯±êÖ¾Î»
 579   3                                                                      alarmCount=0;//±¨¾¯¼ÆÊı´ÎÊıÇåÁã
 580   3              
 581   3                                                                      lastAddr=newAddr;
 582   3                                                                      SensorControl=0;//¹Ø±ÕÈıÖá´«¸ĞÆ÷
 583   3                                                                      
 584   3                                                                 if(TestFlag>=3)//ÓĞÒì³£Çé¿ö»Ö¸´Ê±£¬¿ªÆôµç×ÓËø
 585   3                                                                 {
 586   3                                                                              MagentControl_1=0;//¿ªÆô´ÅÌú
 587   3                                                                              MagentControl_2=1;
 588   3                                                                              Delay(1);
 589   3      //                                                                      MagentControl_1=1;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 590   3      //                                                                      MagentControl_2=1;
 591   3                                                                      
 592   3                                                                              MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 593   3                                                                              MagentControl_2=0;
 594   3                                                                      }
 595   3              
 596   3                                                                      TestFlag=0;     
 597   3                                                                      
 598   3                                                                      if(ModeFlag==3||ModeFlag==2)
 599   3                                                                      {
 600   3                                                                      //»Ö¸´ÁËÕı³££¬×öÏàÓ¦¸´Î»¶¯×÷
 601   3                                                                              ModeFlag=1;
 602   3                                                                      }
 603   3                                                              }
 604   3      
 605   3                                                              else//µØÖ·¹ö¶¯²»ÏàµÈ
 606   3                                                              {
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 11  

 607   3                                                                      newAddr=select(myTxRxData[5]);  //²éÕÒµÚÒ»¸öÃÜÂëµÄµØÖ·
 608   3                                                                      if(newAddr!=1001)//ÕÒµ½ÁËÕâ¸ö
 609   3                                                                      {
 610   3                                                                              if(newAddr>=999)
 611   3                                                                              {
 612   3                                                                                      newAddr=0;
 613   3                                                                                      lastAddr=newAddr;//±£´æÕâ´ÎµÄÃÜÂëµØÖ·£¬ÎªÏÂ´ÎµØÖ·×öĞ£¶ÔÊ¹ÓÃ
 614   3                                                                              }
 615   3                                                                              else
 616   3                                                                              {
 617   3                                                                                      lastAddr=newAddr;//±£´æÕâ´ÎµÄÃÜÂëµØÖ·£¬ÎªÏÂ´ÎµØÖ·×öĞ£¶ÔÊ¹ÓÃ
 618   3                                                                                      newAddr+=1;//µØÖ·¹ö¶¯Ò»´Î
 619   3                                                                              }
 620   3      
 621   3                                                                              ComMode_1_Data(newAddr);//»Ø¸´È·ÈÏĞÅºÅ
 622   3      
 623   3                                                                              alarmFlag=0;//¹Ø±¨¾¯±êÖ¾Î»
 624   3                                                                              alarmCount=0;//±¨¾¯¼ÆÊı´ÎÊıÇåÁã
 625   3                      
 626   3                                                                              lastAddr=newAddr;
 627   3                                                                              SensorControl=0;//¹Ø±ÕÈıÖá´«¸ĞÆ÷
 628   3                                                                              
 629   3                                                                         if(TestFlag>=3)//ÓĞÒì³£Çé¿ö»Ö¸´Ê±£¬¿ªÆôµç×ÓËø
 630   3                                                                         {
 631   3                                                                                      MagentControl_1=0;//¿ªÆô´ÅÌú
 632   3                                                                                      MagentControl_2=1;
 633   3                                                                                      Delay(1);
 634   3                                                                                      MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 635   3                                                                                      MagentControl_2=0;
 636   3                                                                              }
 637   3                      
 638   3                                                                              TestFlag=0;     
 639   3                                                                              
 640   3                                                                              if(ModeFlag==3||ModeFlag==2)
 641   3                                                                              {
 642   3                                                                              //»Ö¸´ÁËÕı³££¬×öÏàÓ¦¸´Î»¶¯×÷
 643   3                                                                                      ModeFlag=1;
 644   3                                                                              }
 645   3                                                                      }
 646   3                                                              }
 647   3              //                                                      }
 648   3              //                                                      else if(newAddr<=1000&&(newAddr-lastAddr<=3))
 649   3              //                                                      else if((newAddr-lastAddr)<=3)
 650   3              //                                                      {
 651   3              //                                                              
 652   3              //                                                              TestFlag=0;
 653   3              //                                                              lastAddr=newAddr;
 654   3              //                                                              SensorControl=1;//¹Ø±ÕÈıÖá´«¸ĞÆ÷
 655   3              //                                                              ComMode_1_Data(newAddr);//»Ø¸´È·ÈÏĞÅºÅ
 656   3              //                                                              if(ModeFlag==2)
 657   3              //                                                              {
 658   3              //                                                              //»Ö¸´ÁËÕı³££¬×öÏàÓ¦¸´Î»¶¯×÷
 659   3              //                                                                      ModeFlag=1;
 660   3              //                                                              }
 661   3              //                                                      }
 662   3              
 663   3                                                              }
 664   3                                      }
 665   3                                      break;
 666   3      */      
 667   3                      }
 668   2              }
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 12  

 669   1      //      }
 670   1      }
 671          
 672          void time0() interrupt 1        //×÷ÎªÕû¸öÏµÍ³×Ô¼ºµÄÊ±ÖÓ
 673          {
 674   1              TH0=timer0H;//ÖØ×°ÔØ
 675   1              TL0=timer0L;
 676   1              time0Count_3++;
 677   1      
 678   1              if(time0Count_3>=60)//´®¿ÚÃ¿1S½ÓÊÜÒ»´ÎµÄÊı¾İµÄÊ±¼ä±êÖ¾
 679   1              {
 680   2                      if(commuFlag==1)//ËµÃ÷¿ªÆôÁËÍ¨ĞÅ
 681   2                      {
 682   3                              TestFlag++;
 683   3      
 684   3                              if(TestFlag>=3&&ModeFlag==1)//ËµÃ÷Ã»ÓĞ½ÓÊÕµ½Êı¾İÒÑ¾­ÓĞ3´ÎÁË£¬¸½»úÒÑ¾­³öÁË3M£¬ÏÖÔÚ¾ÍÒª¼Ó´ó¹¦ÂÊ£¬ÇĞ»»µ½Ä£
             -Ê½2,30MÔÙ¿´ÄÜ²»ÄÜ½ÓÊÕµ½Êı¾İ
 685   3                              {
 686   4                                      TestFlag=5;
 687   4                                      if(ModeFlag==1)
 688   4                                      {
 689   5      //                                      ComMode_2_Data(lastAddr);//Ïò¸½»ú·¢ËÍ±àÂë2
 690   5      //                                      SendData(0xac);//²âÊÔÊı¾İ       
 691   5                                              if(magnetflag==1)
 692   5                                              {
 693   6                                                      MagentControl_1=0;//¿ªÆô´ÅÌú
 694   6                                                      MagentControl_2=1;
 695   6                                                      Delay(27);
 696   6                                                      MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 697   6                                                      MagentControl_2=0;
 698   6                                                      magnetflag=0;
 699   6                                              }
 700   5                      
 701   5                                              SensorControl=1;//¿ªÆôÈıÖá´«¸ĞÆ÷
 702   5                                              downUpFlag=1;//¿ªÆôµ¹µØ¡¢Ì§Æğ±êÖ¾
 703   5                                              ModeFlag=2;
 704   5              
 705   5      //                                      ComMode_2_Data();//Ïò¸½»ú·¢ËÍ±àÂë2
 706   5                                              commode2_flag=1;
 707   5                                      }       
 708   4                              }
 709   3      
 710   3                              if(commode2_flag==1)
 711   3                              {
 712   4                                      ComMode_2_Data();       //Ïò¸½»ú·¢ËÍ±àÂë2       
 713   4                              }
 714   3                      }
 715   2                      time0Count_3=0;
 716   2                      
 717   2                      Check1=GetADCResult(5);//Ê°ÒôÆ÷µÄ¼ì²â
 718   2                      
 719   2                      Check2=GetADCResult(6);//µçÁ¿¼ì²â
 720   2              }
 721   1      
 722   1              if(SensorControl==1)//¼ì²âÈıÖá´«¸ĞÆ÷ÊÇ·ñ´ò¿ª
 723   1              {
 724   2                      if(ReceWave==0)//ËµÃ÷ÓĞ´¥·¢Çé¿ö£¬¿ªÊ¼¼ÆÊ±
 725   2                      {
 726   3                              time0Count_2++;
 727   3                              if(time0Count_2>=30)//ËµÃ÷ÒÑ¾­´óÓÚ0.5S
 728   3                              {
 729   4                                      time0Count_2 =0;//¼ÆÊ±ÆÚÇåÁã
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 13  

 730   4                                      SensorCount++;//ÈıÖá´«¸ĞÆ÷Âö³å¼ÆÊı¼Ó1
 731   4                                      alarmFlag2=1;//
 732   4                              }               
 733   3                      }
 734   2                      else if(ReceWave==1&&SensorCount!=0)//ËµÃ÷ÒÑ¾­ÓĞÒ»¸öÓĞÓÃµÄÂö³å
 735   2                      {
 736   3                              time0Count_1++;
 737   3                              if(time0Count_1>=100)//´óÓÚ5S
 738   3                              {
 739   4                                      SensorCount=0;
 740   4                              }
 741   3                      }
 742   2              }
 743   1       
 744   1              if(ModeFlag==2&&SensorCount>=1)//ÈıÖá´«¸ĞÆ÷Âö³åµÄÏàÓ¦±¨¾¯
 745   1              {
 746   2                      if(SensorCount==1&&alarmFlag2==1)//ÈıÖá´«¸ĞÆ÷Ò»´Î´¥·¢,alarmFlag2¿ØÖÆ·¢Éù1´Î
 747   2                      {                                       
 748   3                              VoiceControl=0;//Ê¹ÓÃÓïÒôÊ±Òª¹Ø±ÕÊ°ÉùÆ÷
 749   3                              PAshutdown=1;  //ÏÈ¹Ø±ÕÊ°ÒôÆ÷£¬È»ºó´ò¿ª¹¦·Å
 750   3                              SC_Speech(1);  //¹Ø»úÓïÑÔÌáĞÑ
 751   3                              Delay(140);
 752   3                              PAshutdown=0;  //ÓïÒôÍê³Éºó£¬¹Ø±Õ¹¦·Å£¬È»ºó´ò¿ªÊ°ÒôÆ÷
 753   3                              VoiceControl=1;//¿ªÆôÊ°ÉùÆ÷
 754   3                              alarmFlag2=0;
 755   3                      }
 756   2      /*
 757   2                      if(SensorCount==2&&alarmFlag2==1)//ÈıÖá´«¸ĞÆ÷¶ş´Î´¥·¢£¬alarmFlag2¿ØÖÆ·¢Éù1´Î
 758   2                      {
 759   2                              VoiceControl=0;//Ê¹ÓÃÓïÒôÊ±Òª¹Ø±ÕÊ°ÉùÆ÷
 760   2                              PAshutdown=1;
 761   2                              SC_Speech(2);  //¹Ø»úÓïÑÔÌáĞÑ
 762   2                              Delay(140);
 763   2                              PAshutdown=0;
 764   2                              VoiceControl=1;//¿ªÆôÊ°ÉùÆ÷
 765   2                              alarmFlag2=0;
 766   2                      }
 767   2      */
 768   2                      if(SensorCount>=2)//ÈıÖá´«¸ĞÆ÷Ò»´Î´¥·¢
 769   2                      {
 770   3      //                      ComMode_3_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 771   3                              ModeFlag=3;//ÈıÖá´«¸ĞÆ÷ÒÑ¾­ÓĞ3´Î´¥·¢ÁË£¬Òª¸Ä±ä·¢ÉäÄ£Ê½ÁË
 772   3                              alarmFlag=1;//ÖÃÓïÒô±¨¾¯Î»
 773   3                              alarmFlag2=0;
 774   3                              SensorCount=0; //Âö³å¼ÆÊıÇåÁã
 775   3                              Delay(1);
 776   3                              commode2_flag=0;
 777   3                              ComMode_3_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 778   3      //                      commode3_flag=1;
 779   3                      }
 780   2              }
 781   1      
 782   1              if(ModeFlag==3)
 783   1              {
 784   2                      if(alarmFlag==1)
 785   2                      {
 786   3                              VoiceControl=0;//Ê¹ÓÃÓïÒôÊ±Òª¹Ø±ÕÊ°ÉùÆ÷
 787   3                              PAshutdown=1;
 788   3                              SC_Speech(3);  //¹Ø»úÓïÑÔÌáĞÑ
 789   3                              Delay(120);
 790   3                              PAshutdown=0;
 791   3                              VoiceControl=1;//¿ªÆôÊ°ÉùÆ÷
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 14  

 792   3                      }
 793   2                      if(alarmFlag==1)
 794   2                      {
 795   3                              VoiceControl=0;//Ê¹ÓÃÓïÒôÊ±Òª¹Ø±ÕÊ°ÉùÆ÷
 796   3                              PAshutdown=1;
 797   3                              SC_Speech(4);  //¹Ø»úÓïÑÔÌáĞÑ
 798   3                              Delay(190);
 799   3                              PAshutdown=0;
 800   3                              VoiceControl=1;//¿ªÆôÊ°ÉùÆ÷
 801   3                      }
 802   2                      if(ModeFlag==3)
 803   2                      {
 804   3                              ComMode_3_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 805   3                      }
 806   2                      if(alarmFlag==1)
 807   2                      {
 808   3                              VoiceControl=0;//Ê¹ÓÃÓïÒôÊ±Òª¹Ø±ÕÊ°ÉùÆ÷
 809   3                              PAshutdown=1;
 810   3                              SC_Speech(3);  //¹Ø»úÓïÑÔÌáĞÑ
 811   3                              Delay(120);
 812   3                              PAshutdown=0;
 813   3                              VoiceControl=1;//¿ªÆôÊ°ÉùÆ÷
 814   3                      }
 815   2                      if(alarmFlag==1)
 816   2                      {
 817   3                              VoiceControl=0;//Ê¹ÓÃÓïÒôÊ±Òª¹Ø±ÕÊ°ÉùÆ÷
 818   3                              PAshutdown=1;
 819   3                              SC_Speech(11);  //¹Ø»úÓïÑÔÌáĞÑ
 820   3                              Delay(190);
 821   3                              PAshutdown=0;
 822   3                              VoiceControl=1;//¿ªÆôÊ°ÉùÆ÷
 823   3                      }
 824   2                      if(ModeFlag==3)
 825   2                      {
 826   3                              ComMode_3_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 827   3                      }
 828   2                      if(alarmCount>=20) //µ÷½ÚÓïÒôµÄ¶ÎÊı
 829   2                      {
 830   3                              alarmCount=0;//Çå±¨¾¯¼ÆÊıÆ÷
 831   3                              alarmFlag=0;//Çå±¨¾¯±êÖ¾
 832   3                      }
 833   2                      alarmCount++;
 834   2              }
 835   1      }
 836          
 837          void ComMode_1_Data()//·¢ËÍ±ßÂë1
 838          {
 839   1      //      P0M1&=0xfd;      //¸ß×èÄ£Ê½     £¬Ïàµ±¹Ø·¢Éä»ú
 840   1      //      P0M2&=0xfd;
 841   1      //      myPwm();        //¿ª·¢Éä»ú
 842   1      //      ModeTurn=0;
 843   1      /*
 844   1              SendData(0x55);
 845   1              SendData(0xf0);
 846   1              SendData(0xaa);
 847   1              SendData(0x0f);
 848   1      */
 849   1              unsigned char i,n;
 850   1              ModeControl_1=1;//30M·¢Éä¹¦ÂÊ                           
 851   1      
 852   1              myTxRxData[0]=CmdHead;
 853   1              myTxRxData[1]=MyAddress;
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 15  

 854   1              myTxRxData[2]=ComMode_1;
 855   1              myTxRxData[3]=0x00;
 856   1              myTxRxData[4]=0x00;
 857   1              myTxRxData[5]=0x00;
 858   1              myTxRxData[6]=0x00;
 859   1      
 860   1              initsignal2();                                                                                                     
 861   1      
 862   1              for(i=0;i<7;i++)
 863   1              {
 864   2                      for(n=0;n<8;n++)
 865   2                      {
 866   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 867   3                              {
 868   4                                      P10=0;
 869   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 870   4                              }
 871   3                              else//Îª0µÄÇé¿ö
 872   3                              {
 873   4                                      P10=0;
 874   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 875   4                              }
 876   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 877   3                              myTxRxData[i]<<=1;
 878   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
 879   3                      }
 880   2              }
 881   1      
 882   1      //      codeData(myTxRxData,7);
 883   1      //      SendNByte(TxRxBuf,28);
 884   1      //      PWMCON0=0x00;//¹Ø±ÕPWM
 885   1      //      P0M1|=0x02;      //¸ß×èÄ£Ê½     £¬Ïàµ±¹Ø·¢Éä»ú
 886   1      //      P0M2&=0xfd;
 887   1      //      ModeTurn=1;
 888   1      }
 889          
 890          void ComMode_2_Data()//·¢ËÍ±ßÂë2
 891          {
 892   1      //      P0M1&=0xfd;      //¸ß×èÄ£Ê½     £¬Ïàµ±¹Ø·¢Éä»ú
 893   1      //      P0M2&=0xfd;
 894   1      //      myPwm();        //¿ª·¢Éä»ú
 895   1      //      ModeTurn=0;
 896   1      /*
 897   1              SendData(0x55);
 898   1              SendData(0xf0);
 899   1              SendData(0xaa);
 900   1              SendData(0x0f);
 901   1      */
 902   1              unsigned char i,n;
 903   1              ModeControl_1=1;//30M·¢Éä¹¦ÂÊ
 904   1      
 905   1              myTxRxData[0]=CmdHead;
 906   1              myTxRxData[1]=MyAddress;
 907   1              myTxRxData[2]=0xc2;
 908   1              myTxRxData[3]=0x00;
 909   1              myTxRxData[4]=0x00;
 910   1              myTxRxData[5]=0x00;
 911   1              myTxRxData[6]=0x00;
 912   1      
 913   1              initsignal2();
 914   1      
 915   1              for(i=0;i<7;i++)
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 16  

 916   1              {
 917   2                      for(n=0;n<8;n++)
 918   2                      {
 919   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 920   3                              {
 921   4                                      P10=0;
 922   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 923   4                              }
 924   3                              else//Îª0µÄÇé¿ö
 925   3                              {
 926   4                                      P10=0;
 927   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 928   4                              }
 929   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 930   3                              myTxRxData[i]<<=1;
 931   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
 932   3                      }
 933   2              }
 934   1      //      codeData(myTxRxData,7); //½øĞĞ±àÂë
 935   1      //      SendNByte(TxRxBuf,28);
 936   1      //      PWMCON0=0x00;//¹Ø±ÕPWM
 937   1      //      P0M1|=0x02;      //¸ß×èÄ£Ê½     £¬Ïàµ±¹Ø·¢Éä»ú
 938   1      //      P0M2&=0xfd;
 939   1      //      ModeTurn=1;
 940   1      }
 941          
 942          void ComMode_22_Data()//·¢ËÍ±ßÂë2
 943          {
 944   1              unsigned char i,n;
 945   1              ModeControl_1=1;//30M·¢Éä¹¦ÂÊ
 946   1      
 947   1              myTxRxData[0]=CmdHead;
 948   1              myTxRxData[1]=MyAddress;
 949   1              myTxRxData[2]=0xc2;
 950   1              myTxRxData[3]=0x00;
 951   1              myTxRxData[4]=0x00;
 952   1              myTxRxData[5]=0x00;
 953   1              myTxRxData[6]=0x00;
 954   1      
 955   1              initsignal();
 956   1      
 957   1              for(i=0;i<7;i++)
 958   1              {
 959   2                      for(n=0;n<8;n++)
 960   2                      {
 961   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 962   3                              {
 963   4                                      P10=0;
 964   4                                      Delay33(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 965   4                              }
 966   3                              else//Îª0µÄÇé¿ö
 967   3                              {
 968   4                                      P10=0;
 969   4                                      Delay33(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 970   4                              }
 971   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 972   3                              myTxRxData[i]<<=1;
 973   3                              Delay33(50);//ÑÓÊ±Òª´óÓÚ2ms
 974   3                      }
 975   2              }
 976   1      }
 977          
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 17  

 978          void ComMode_3_Data()//·¢ËÍ±ßÂë3
 979          {
 980   1      //      P0M1&=0xfd;      //¸ß×èÄ£Ê½     £¬Ïàµ±¹Ø·¢Éä»ú
 981   1      //      P0M2&=0xfd;
 982   1      //      myPwm();        //¿ª·¢Éä»ú
 983   1      //      ModeTurn=0;
 984   1      /*
 985   1              SendData(0x55);
 986   1              SendData(0xf0);
 987   1              SendData(0xaa);
 988   1              SendData(0x0f);
 989   1      */
 990   1              unsigned char i,n;
 991   1              ModeControl_1=0;//ÇĞ»»Îª300M·¢Éä
 992   1      
 993   1              myTxRxData[0]=CmdHead;
 994   1              myTxRxData[1]=MyAddress;
 995   1              myTxRxData[2]=ComMode_3;
 996   1              myTxRxData[3]=0x00;
 997   1              myTxRxData[4]=0x00;
 998   1              myTxRxData[5]=0x00;
 999   1              myTxRxData[6]=0x00;
1000   1      
1001   1              initsignal2();
1002   1      
1003   1              for(i=0;i<7;i++)
1004   1              {
1005   2                      for(n=0;n<8;n++)
1006   2                      {
1007   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
1008   3                              {
1009   4                                      P10=0;
1010   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
1011   4                              }
1012   3                              else//Îª0µÄÇé¿ö
1013   3                              {
1014   4                                      P10=0;
1015   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
1016   4                              }
1017   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
1018   3                              myTxRxData[i]<<=1;
1019   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
1020   3                      }
1021   2              }
1022   1      //      codeData(myTxRxData,7); //½øĞĞ±àÂë
1023   1      //      SendNByte(TxRxBuf,28);
1024   1      //      PWMCON0=0x00;//¹Ø±ÕPWM
1025   1      //      P0M1|=0x02;      //¸ß×èÄ£Ê½     £¬Ïàµ±¹Ø·¢Éä»ú
1026   1      //      P0M2&=0xfd;
1027   1      //      ModeTurn=1;
1028   1              ModeControl_1=1;                //·¢ËÍ±àÂë3Íê³Éºó£¬½«Ä£Ê½ÓÖÇĞ»»³É30m¾àÀë
1029   1      }
1030          
1031          void ComMode_4_Data()//·¢ËÍÌ§Æğ±àÂë
1032          {
1033   1      //      P0M1&=0xfd;      //¸ß×èÄ£Ê½     £¬Ïàµ±¹Ø·¢Éä»ú
1034   1      //      P0M2&=0xfd;
1035   1      //      myPwm();        //¿ª·¢Éä»ú
1036   1      //      ModeTurn=0;
1037   1      /*
1038   1              SendData(0x55);
1039   1              SendData(0xf0);
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 18  

1040   1              SendData(0xaa);
1041   1              SendData(0x0f);
1042   1      */
1043   1              unsigned char i,n;
1044   1              ModeControl_1=0;//ÇĞ»»Îª300M·¢Éä
1045   1      
1046   1              myTxRxData[0]=CmdHead;
1047   1              myTxRxData[1]=MyAddress;
1048   1              myTxRxData[2]=ComMode_4;
1049   1              myTxRxData[3]=0x00;
1050   1              myTxRxData[4]=0x00;
1051   1              myTxRxData[5]=0x00;
1052   1              myTxRxData[6]=0x00;
1053   1      
1054   1              initsignal2();
1055   1      
1056   1              for(i=0;i<7;i++)
1057   1              {
1058   2                      for(n=0;n<8;n++)
1059   2                      {
1060   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
1061   3                              {
1062   4                                      P10=0;
1063   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
1064   4                              }
1065   3                              else//Îª0µÄÇé¿ö
1066   3                              {
1067   4                                      P10=0;
1068   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
1069   4                              }
1070   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
1071   3                              myTxRxData[i]<<=1;
1072   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
1073   3                      }
1074   2              }
1075   1      //      codeData(myTxRxData,7); //½øĞĞ±àÂë
1076   1      //      SendNByte(TxRxBuf,28);
1077   1      //      PWMCON0=0x00;//¹Ø±ÕPWM
1078   1      //      P0M1|=0x02;      //¸ß×èÄ£Ê½     £¬Ïàµ±¹Ø·¢Éä»ú
1079   1      //      P0M2&=0xfd;
1080   1      //      ModeTurn=1;
1081   1      }
1082          
1083          void ComMode_5_Data()//·¢ËÍµ¹µØ±àÂë
1084          {
1085   1      //      P0M1&=0xfd;      //¸ß×èÄ£Ê½     £¬Ïàµ±¹Ø·¢Éä»ú
1086   1      //      P0M2&=0xfd;
1087   1      //      myPwm();        //¿ª·¢Éä»ú
1088   1      //      ModeTurn=0;
1089   1      /*
1090   1              SendData(0x55);
1091   1              SendData(0xf0);
1092   1              SendData(0xaa);
1093   1              SendData(0x0f);
1094   1      */
1095   1              unsigned char i,n;
1096   1              ModeControl_1=0;//ÇĞ»»Îª300M·¢Éä
1097   1      
1098   1              myTxRxData[0]=CmdHead;
1099   1              myTxRxData[1]=MyAddress;
1100   1              myTxRxData[2]=ComMode_5;
1101   1              myTxRxData[3]=0x00;
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 19  

1102   1              myTxRxData[4]=0x00;
1103   1              myTxRxData[5]=0x00;
1104   1              myTxRxData[6]=0x00;
1105   1      
1106   1              initsignal2();
1107   1      
1108   1              for(i=0;i<7;i++)
1109   1              {
1110   2                      for(n=0;n<8;n++)
1111   2                      {
1112   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
1113   3                              {
1114   4                                      P10=0;
1115   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
1116   4                              }
1117   3                              else//Îª0µÄÇé¿ö
1118   3                              {
1119   4                                      P10=0;
1120   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
1121   4                              }
1122   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
1123   3                              myTxRxData[i]<<=1;
1124   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
1125   3                      }
1126   2              }
1127   1      //      codeData(myTxRxData,7); //½øĞĞ±àÂë
1128   1      //      SendNByte(TxRxBuf,28);
1129   1      //      PWMCON0=0x00;//¹Ø±ÕPWM
1130   1      //      P0M1|=0x02;      //¸ß×èÄ£Ê½     £¬Ïàµ±¹Ø·¢Éä»ú
1131   1      //      P0M2&=0xfd;
1132   1      //      ModeTurn=1;     
1133   1      }
1134          
1135          /*
1136          void codeData(unsigned char *doData,unsigned char len)          //±àÂë ,µçÆ½1±äÎª0011£¬µçÆ½0±äÎª1100
1137          {
1138                  unsigned char n,j,i=0;
1139                  for(n=0;n<len;n++)
1140                  {       
1141                          for(j=0;j<8;j++)        
1142                          {
1143                                  if(j==0||j==1)
1144                                  {       
1145                                           TxRxBuf[i]<<=4;
1146                                          if((*doData&0x80)==0x80)
1147                                          {
1148                                                  TxRxBuf[i]|=0x03;       
1149                                          }
1150                                          else
1151                                          {
1152                                                  TxRxBuf[i]|=0x0c;
1153                                          }
1154                                          *doData<<=1;
1155                                  }
1156                                  else if(j==2||j==3)
1157                                  {
1158                                          TxRxBuf[i+1]<<=4;
1159                                          if((*doData&0x80)==0x80)
1160                                          {
1161                                                  TxRxBuf[i+1]|=0x03;     
1162                                          }
1163                                          else
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 20  

1164                                          {
1165                                                  TxRxBuf[i+1]|=0x0c;
1166                                          }
1167                                          *doData<<=1;
1168                                  }
1169                                  else if(j==4||j==5)
1170                                  {
1171                                          TxRxBuf[i+2]<<=4;
1172                                          if((*doData&0x80)==0x80)
1173                                          {
1174                                                  TxRxBuf[i+2]|=0x03;             
1175                                          }
1176                                          else
1177                                          {
1178                                                  TxRxBuf[i+2]|=0x0c;
1179                                          }
1180                                          *doData<<=1;
1181                                  }
1182                                  else if(j==6||j==7)
1183                                  {
1184                                          TxRxBuf[i+3]<<=4;
1185                                          if((*doData&0x80)==0x80)
1186                                          {
1187                                                  TxRxBuf[i+3]|=0x03;                                             
1188                                          }
1189                                          else
1190                                          {
1191                                                  TxRxBuf[i+3]|=0x0c;                             
1192                                          }
1193                                          *doData<<=1;
1194                                  }
1195                          }
1196                          i+=4;
1197                          doData++;
1198                  }
1199          }
1200          */
1201          /*
1202          void transCode(unsigned char *doData,unsigned char len)//½âÂë£¬½«½ÓÊÕµ½µÃÊı¾İ»¹Ô­
1203          {
1204                  unsigned char i,j;
1205                  for(i=0;i<len;i++)
1206                  {
1207                          for(j=0;j<2;j++)
1208                          {
1209                                  myTxRxData[i/4]<<=1;
1210          
1211                                  if((*doData&0x30)==0x30)//ËµÃ÷Îª1
1212                                  {
1213                                          myTxRxData[i/4]|=0x01;
1214                                  }
1215                                  else if((*doData&0xc0)==0xc0)  //ËµÃ÷Îª0
1216                                  {
1217                                          myTxRxData[i/4]&=0xfe;  
1218                                  }
1219          
1220                                  *doData<<=4;
1221                          }
1222                          doData++;
1223                  }
1224          }
1225          */
C51 COMPILER V9.01   NEWHOST                                                               05/30/2013 10:23:43 PAGE 21  



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1844    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     65      10
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =     13    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
